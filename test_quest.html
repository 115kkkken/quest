<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å›åˆä»»å‹™éŠæˆ²ï¼ˆå–®æª”ï¼‰</title>
  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --muted:#bbb;
      --accent:#1ea7fd;
      --success:#2ecc71;
      --fail:#e74c3c;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--fg);
    }

    .center{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:20px;
      padding:24px;
      box-sizing:border-box;
      text-align:center;
    }

    h1{ margin:0; font-size:20px; letter-spacing:0.6px; font-weight:600; }

    /* ä¸»ç•«é¢åœ“åœˆåˆ— - å‚ç›´ç½®ä¸­ä»¥ç¢ºä¿æ‰€æœ‰åœ“åœˆé«˜åº¦ä¸€è‡´ */
    .circle-row{
      display:flex;
      gap:18px;
      align-items:center; /* æ”¹ç‚º centerï¼Œè®“æ‰€æœ‰åœ“åœˆåŸºç·šç›¸åŒ */
      justify-content:center;
      flex-wrap:wrap;
    }

    .circle-wrap{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
      position:relative;
      /* çµ±ä¸€ wrap çš„æœ€å°é«˜åº¦ï¼Œç¢ºä¿é«˜åº¦ä¸€è‡´ */
      min-height: 110px;
      box-sizing: border-box;
    }

    /* pair åŒ…å«ç¬¬ä¸‰å’Œç¬¬å››å›åˆï¼Œprotect label ç½®ä¸­åœ¨å…©è€…ä¸Šæ–¹ï¼ˆä½¿ç”¨çµ•å°å®šä½ï¼Œä¸å½±éŸ¿å…¶ä»– wrap çš„ä½ç½®ï¼‰ */
    .pair-wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      position:relative;
    }
    .pair-circles{
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:center;
    }

    .protect-label{
      font-size:13px;
      color:var(--accent);
      font-weight:700;
      letter-spacing:0.2px;
      background:rgba(30,167,253,0.06);
      padding:6px 10px;
      border-radius:8px;
      border:1px solid rgba(30,167,253,0.08);
      position:absolute;
      top: -22px; /* ç½®æ–¼å…©å€‹åœ“åœˆä¸Šæ–¹ï¼Œä¸æœƒå½±éŸ¿å…¶ä»–å…ƒç´ é«˜åº¦ */
      left: 50%;
      transform: translateX(-50%);
      white-space:nowrap;
    }

    .round-label{
      font-size:12px;
      color:var(--muted);
    }

    .circle{
      width:88px;
      height:88px;
      border-radius:50%;
      background:transparent;
      color:var(--fg);
      border:2px solid var(--fg);
      font-size:28px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      transition: transform .12s ease, background .12s ease, color .12s ease, opacity .12s ease, box-shadow .12s ease;
      user-select:none;
      box-sizing: border-box;
    }

    .circle:focus{
      outline:3px solid rgba(255,255,255,0.12);
      transform:translateY(-4px);
    }

    .circle:hover{
      transform:translateY(-6px);
      background:rgba(255,255,255,0.06);
    }

    /* å·²å®Œæˆçµæœç‹€æ…‹ï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰ */
    .circle.result-success{
      background: var(--success);
      border-color: var(--success);
      color: #06270b;
      box-shadow: 0 6px 18px rgba(46,204,113,0.12);
      cursor: default;
      transform: translateY(0) !important;
      opacity: 1;
      pointer-events: none;
    }
    .circle.result-fail{
      background: var(--fail);
      border-color: var(--fail);
      color: #fff;
      box-shadow: 0 6px 18px rgba(231,76,60,0.12);
      cursor: default;
      transform: translateY(0) !important;
      opacity: 1;
      pointer-events: none;
    }

    /* result / action area */
    .muted{ color:var(--muted); }

    .action-row{
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:center;
      margin-top:8px;
    }

    .action{
      padding:10px 18px;
      border-radius:8px;
      border:2px solid var(--fg);
      background:transparent;
      color:var(--fg);
      cursor:pointer;
      font-size:16px;
      transition:background .12s ease, transform .12s ease;
    }

    .action:focus{ outline:3px solid rgba(255,255,255,0.08); transform:translateY(-3px); }
    .action.success{ border-color:var(--success); color:var(--success); }
    .action.fail{ border-color:var(--fail); color:var(--fail); }
    .action.reset{ border-color:var(--accent); color:var(--accent); }

    .action:hover{ background:rgba(255,255,255,0.04); transform:translateY(-4px); }

    .outcome{
      margin-top:18px;
      padding:18px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      background:rgba(255,255,255,0.02);
      min-width:220px;
    }

    .outcome.hidden{ display:none; }

    .visually-hidden{
      position:absolute!important;
      height:1px;width:1px;
      overflow:hidden;clip:rect(1px,1px,1px,1px);
      white-space:nowrap;border:0;padding:0;margin:-1px;
    }

    /* å…©å€‹ã€Œç•«é¢ã€çš„å®¹å™¨ï¼Œé€é .hidden åˆ‡æ›é¡¯ç¤º */
    .screen{ width:100%; max-width:900px; transition: opacity .18s ease, transform .18s ease; }
    .hidden{ display:none !important; opacity:0; transform:translateY(8px); }

    /* å‹åˆ©æ©«å¹…ï¼ˆé è¨­éš±è—ï¼‰ */
    .banner{
      margin-top:6px;
      padding:14px 20px;
      border-radius:10px;
      font-weight:700;
      letter-spacing:0.6px;
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:center;
      min-width:260px;
    }
    .banner.good{
      background: linear-gradient(90deg, rgba(46,204,113,0.12), rgba(46,204,113,0.06));
      color:var(--success);
      border:1px solid rgba(46,204,113,0.12);
    }
    .banner.bad{
      background: linear-gradient(90deg, rgba(231,76,60,0.12), rgba(231,76,60,0.06));
      color:var(--fail);
      border:1px solid rgba(231,76,60,0.12);
    }

    /* ç•¶éŠæˆ²çµæŸæ™‚ï¼Œéš±è—ä¸»å…§å®¹ä¸¦æŠŠ banner æ‹‰æˆå…¨è¢å¹•ç½®ä¸­é¡¯ç¤º */
    .game-over #mainContent { display: none !important; }
    .game-over #gameBanner {
      display:flex !important;
      position:fixed;
      inset:0;
      align-items:center;
      justify-content:center;
      z-index:999;
      background: linear-gradient(180deg, rgba(0,0,0,0.92), rgba(0,0,0,0.96));
      font-size:28px;
      flex-direction:column;
      gap:18px;
      padding:20px;
    }
    .game-over #gameBanner .action { font-size:18px; padding:12px 20px; }

    /* å°è¢å¹•èª¿æ•´ */
    @media (max-width:480px){
      .circle{ width:64px; height:64px; font-size:20px; }
      .center{ gap:16px; padding:12px; }
      .game-over #gameBanner { font-size:20px; padding:12px; }
      .protect-label{ font-size:11px; padding:4px 8px; top:-18px; }
      .circle-wrap { min-height: 92px; }
    }
  </style>
</head>
<body>
  <main class="center" id="app">
    <h1 class="visually-hidden">å›åˆä»»å‹™éŠæˆ²</h1>

    <!-- ä¸»ç•«é¢ -->
    <section id="mainScreen" class="screen" aria-live="polite">
      <!-- ä¸»è¦å…§å®¹ï¼ˆåœ¨éŠæˆ²çµæŸæ™‚æœƒæ•´å€‹éš±è—ï¼‰ -->
      <div id="mainContent">
        <h1>é¸æ“‡å›åˆä¸¦é€²è¡Œä»»å‹™</h1>
        <p class="muted">æœ€å·¦ç‚ºç¬¬ 1 å›åˆï¼Œä¾åºç‚ºç¬¬ 2ã€3ã€4ã€5 å›åˆã€‚ç•¶ä»»å‹™æˆåŠŸæˆ–å¤±æ•—å¾Œï¼Œè©²å›åˆæœƒé¡¯ç¤ºçµæœé¡è‰²ã€‚</p>

        <div class="circle-row" role="list" aria-label="æ•¸å­—é¸å–®">
          <!-- ç¬¬ä¸€èˆ‡ç¬¬äºŒå›åˆä¿ç•™åŸçµæ§‹ -->
          <div class="circle-wrap">
            <button class="circle" role="listitem" data-round="1" data-num="3" aria-label="å›åˆ 1ï¼šé¸æ“‡ 3">3</button>
            <div class="round-label">å›åˆ 1</div>
          </div>

          <div class="circle-wrap">
            <button class="circle" role="listitem" data-round="2" data-num="4" aria-label="å›åˆ 2ï¼šé¸æ“‡ 4">4</button>
            <div class="round-label">å›åˆ 2</div>
          </div>

          <!-- pair-wrap åŒ…å«ç¬¬ä¸‰èˆ‡ç¬¬å››å›åˆï¼Œprotect label ç½®ä¸­åœ¨å…©è€…ä¸Šæ–¹ -->
          <div class="pair-wrap" aria-hidden="false">
            <div class="protect-label" aria-hidden="true">ä½¿ç”¨é­”æ³•è­·èº«ç¬¦</div>

            <div class="pair-circles">
              <div class="circle-wrap">
                <button class="circle" role="listitem" data-round="3" data-num="5" aria-label="å›åˆ 3ï¼šé¸æ“‡ 5">5</button>
                <div class="round-label">å›åˆ 3</div>
              </div>

              <div class="circle-wrap">
                <button class="circle" role="listitem" data-round="4" data-num="5" aria-label="å›åˆ 4ï¼šé¸æ“‡ 5 å…©å€‹">5</button>
                <div class="round-label">å›åˆ 4</div>
              </div>
            </div>
          </div>

          <!-- ç¬¬äº”å›åˆ -->
          <div class="circle-wrap">
            <button class="circle" role="listitem" data-round="5" data-num="6" aria-label="å›åˆ 5ï¼šé¸æ“‡ 6">6</button>
            <div class="round-label">å›åˆ 5</div>
          </div>
        </div>

        <!-- ä»»å‹™å€å¡Š -->
        <div style="margin-top:18px;">
          <p id="selectedInfo" class="muted">å°šæœªé¸æ“‡å›åˆ</p>

          <!-- é è¨­éš±è—ï¼Œåªæœ‰åœ¨é¸æ“‡å›åˆå¾Œæ‰é¡¯ç¤º -->
          <div class="action-row hidden" id="actions" aria-label="é¸æ“‡çµæœ">
            <button id="successBtn" class="action success">ä»»å‹™æˆåŠŸ</button>
            <button id="failBtn" class="action fail">å¤±æ•—</button>
          </div>

          <div id="outcome" class="outcome hidden" role="status" aria-live="polite">
            <p id="outcomeText"></p>
            <div style="margin-top:12px; display:flex; gap:10px; justify-content:center;">
              <button id="backBtn" class="action">å–æ¶ˆé¸æ“‡</button>
            </div>
          </div>
        </div>
      </div>

      <!-- éŠæˆ²å‹åˆ©é¡¯ç¤ºï¼ˆæ”¾åœ¨ mainScreen è£¡ï¼Œä½†ç•¶ game-over æ™‚æœƒè¢«æ”¾æˆå…¨è¢å¹•ï¼‰ -->
      <div id="gameBanner" class="banner hidden" role="status" aria-live="assertive">
        <div id="bannerText"></div>
        <button id="resetBtn" class="action reset">é‡æ–°é–‹å§‹</button>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const app = document.getElementById('app');
      const circles = Array.from(document.querySelectorAll('.circle'));
      const selectedInfo = document.getElementById('selectedInfo');
      const successBtn = document.getElementById('successBtn');
      const failBtn = document.getElementById('failBtn');
      const actions = document.getElementById('actions');
      const outcome = document.getElementById('outcome');
      const outcomeText = document.getElementById('outcomeText');
      const backBtn = document.getElementById('backBtn');
      const resetBtn = document.getElementById('resetBtn');
      const gameBanner = document.getElementById('gameBanner');
      const bannerText = document.getElementById('bannerText');

      // ç‹€æ…‹é™£åˆ—ï¼šindex 0..4 å°æ‡‰å›åˆ 1..5
      const states = Array(5).fill('pending'); // 'pending' | 'success' | 'fail'
      let currentIndex = null; // è¢«é¸çš„å›åˆ index (0-4)
      let gameOver = false;

      function updateSelectedInfo() {
        if (currentIndex === null) {
          selectedInfo.textContent = 'å°šæœªé¸æ“‡å›åˆ';
        } else {
          const round = currentIndex + 1;
          const num = circles[currentIndex].dataset.num;
          selectedInfo.textContent = `ç¬¬ ${round} å›åˆï¼ˆæ•¸å­— ${num}ï¼‰`;
        }
      }

      function showOutcome(text) {
        outcomeText.textContent = text;
        outcome.classList.remove('hidden');
      }

      function hideOutcome() {
        outcome.classList.add('hidden');
      }

      function setCircleResult(idx, ok) {
        const btn = circles[idx];
        btn.classList.remove('result-success', 'result-fail');
        if (ok) {
          btn.classList.add('result-success');
          btn.setAttribute('aria-label', `å›åˆ ${idx+1}ï¼š${btn.dataset.num}ï¼ˆä»»å‹™æˆåŠŸï¼‰`);
          states[idx] = 'success';
        } else {
          btn.classList.add('result-fail');
          btn.setAttribute('aria-label', `å›åˆ ${idx+1}ï¼š${btn.dataset.num}ï¼ˆä»»å‹™å¤±æ•—ï¼‰`);
          states[idx] = 'fail';
        }
        btn.disabled = true;
      }

      function countResults() {
        const succ = states.filter(s => s === 'success').length;
        const fail = states.filter(s => s === 'fail').length;
        return {succ, fail};
      }

      function endGame(goodWins) {
        gameOver = true;
        // disable all remaining buttons
        circles.forEach(b => b.disabled = true);
        actions.querySelectorAll('button').forEach(b => b.disabled = true);

        // show banner with message and make it fullscreen (CSS .game-over handles hiding other things)
        bannerText.textContent = goodWins ? 'å¥½äººç²å‹ ğŸ‰' : 'å£äººç²å‹ ğŸ˜ˆ';
        gameBanner.classList.remove('hidden');
        gameBanner.classList.remove('good','bad');
        if (goodWins) gameBanner.classList.add('good');
        else gameBanner.classList.add('bad');

        // hide main content and show banner fullscreen
        app.classList.add('game-over');

        // focus reset button for accessibility
        setTimeout(() => resetBtn.focus(), 80);
      }

      function checkWin() {
        const {succ, fail} = countResults();
        if (succ >= 3) { endGame(true); return true; }
        if (fail >= 3) { endGame(false); return true; }
        return false;
      }

      function resetGame() {
        // reset states
        for (let i=0;i<states.length;i++) states[i] = 'pending';
        circles.forEach((btn, i) => {
          btn.classList.remove('result-success','result-fail');
          btn.disabled = false;
          btn.setAttribute('aria-label', `å›åˆ ${i+1}ï¼šé¸æ“‡ ${btn.dataset.num}`);
        });
        currentIndex = null;
        gameOver = false;
        hideOutcome();
        updateSelectedInfo();
        // hide actions until a circle is clicked again
        actions.classList.add('hidden');
        // hide banner and remove game-over mode
        gameBanner.classList.add('hidden');
        gameBanner.classList.remove('good','bad');
        app.classList.remove('game-over');
        // enable action buttons
        actions.querySelectorAll('button').forEach(b => b.disabled = false);
        // focus first button
        if (circles[0]) circles[0].focus();
      }

      // binding circle buttons
      circles.forEach((btn, i) => {
        btn.addEventListener('click', () => {
          if (gameOver) return;
          if (btn.disabled) return;
          currentIndex = i;
          updateSelectedInfo();
          hideOutcome();
          // show action buttons (only after a circle is selected)
          actions.classList.remove('hidden');
          // focus success button
          successBtn.focus();
        });
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); btn.click(); }
        });
      });

      // action buttons
      successBtn.addEventListener('click', () => {
        if (currentIndex === null || gameOver) return;
        setCircleResult(currentIndex, true);
        showOutcome('ä»»å‹™æˆåŠŸ');
        currentIndex = null;
        updateSelectedInfo();
        if (!checkWin()) {
          // éš±è— actionsï¼Œå¿…é ˆé‡æ–°é¸æ“‡å›åˆæ‰èƒ½å†é¡¯ç¤º
          actions.classList.add('hidden');
          // focus next available unfinished button if any
          const next = circles.find(c => !c.disabled);
          if (next) next.focus();
        }
      });

      failBtn.addEventListener('click', () => {
        if (currentIndex === null || gameOver) return;
        setCircleResult(currentIndex, false);
        showOutcome('ä»»å‹™å¤±æ•—');
        currentIndex = null;
        updateSelectedInfo();
        if (!checkWin()) {
          actions.classList.add('hidden');
          const next = circles.find(c => !c.disabled);
          if (next) next.focus();
        }
      });

      // back button just clears selection
      backBtn.addEventListener('click', () => {
        currentIndex = null;
        updateSelectedInfo();
        hideOutcome();
        actions.classList.add('hidden');
        const first = circles.find(c => !c.disabled) || circles[0];
        if (first) first.focus();
      });

      resetBtn.addEventListener('click', () => {
        resetGame();
      });

      // keyboard support for action buttons
      [successBtn, failBtn, backBtn, resetBtn].forEach(b => {
        b.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); b.click(); }
        });
      });

      // quick select by number key 1..5 (å›åˆ) æˆ– 3/4/5/6 (æ•¸å­—)
      document.addEventListener('keydown', (e) => {
        const tag = document.activeElement && document.activeElement.tagName.toLowerCase();
        if (tag === 'input' || tag === 'textarea') return;

        if (gameOver) {
          // allow R to reset
          if (e.key.toLowerCase() === 'r') { e.preventDefault(); resetGame(); }
          return;
        }

        // å¦‚æœæŒ‰ 1..5ï¼Œé¸å›åˆ
        if (['1','2','3','4','5'].includes(e.key)) {
          const round = Number(e.key);
          const btn = circles[round-1];
          if (btn && !btn.disabled) {
            e.preventDefault();
            btn.click();
          }
        }
        // å¦‚æœæŒ‰æ•¸å­— 3/4/5/6ï¼Œé¸ç¬¬ä¸€å€‹å°æ‡‰æ•¸å­—æœªå®Œæˆçš„å›åˆ
        if (['3','4','5','6'].includes(e.key)) {
          const numKey = e.key;
          const btn = circles.find(c => c.dataset.num === numKey && !c.disabled);
          if (btn) {
            e.preventDefault();
            btn.click();
          }
        }
        // Esc æ¸…é™¤é¸å–
        if (e.key === 'Escape') {
          if (currentIndex !== null) {
            currentIndex = null;
            updateSelectedInfo();
            hideOutcome();
            actions.classList.add('hidden');
            const first = circles.find(c => !c.disabled) || circles[0];
            if (first) first.focus();
          }
        }
      });

      // initial focus & info
      window.addEventListener('load', () => {
        updateSelectedInfo();
        if (circles[0]) circles[0].focus();
      });

    })();
  </script>
</body>
</html>
